<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé¢è¯•æ¥å£æµ‹è¯•å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
        }

        .card-subtitle {
            font-size: 0.9em;
            color: #718096;
            margin-top: 4px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #4a5568;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: block;
            padding: 12px 15px;
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }

        .file-input-label:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .file-input-label.has-file {
            border-color: #48bb78;
            background: #f0fff4;
            color: #22543d;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(30deg);
            transition: all 0.6s;
        }

        .btn:hover::after {
            transform: rotate(30deg) translate(20%, 20%);
        }

        .response-panel {
            background: #1a202c;
            color: #68d391;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            position: relative;
            border: 1px solid #2d3748;
        }

        .response-panel.error {
            color: #fc8181;
        }

        .response-panel.loading {
            color: #63b3ed;
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2d3748;
        }

        .response-title {
            color: #a0aec0;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .response-time {
            color: #718096;
            font-size: 11px;
        }

        .chat-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: #f7fafc;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.interviewer {
            margin-left: auto;
            text-align: right;
        }

        .message-bubble {
            display: inline-block;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message.candidate .message-bubble {
            background: #667eea;
            color: white;
            border-bottom-left-radius: 4px;
        }

        .message.interviewer .message-bubble {
            background: white;
            color: #2d3748;
            border: 1px solid #e2e8f0;
            border-bottom-right-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .message-meta {
            font-size: 11px;
            color: #a0aec0;
            margin-top: 5px;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .audio-btn {
            background: #edf2f7;
            border: 2px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .audio-btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }

        .audio-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-badge.success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-badge.error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-badge.pending {
            background: #feebc8;
            color: #744210;
        }

        .session-info {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border: 1px solid #667eea30;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .session-id {
            font-family: monospace;
            background: white;
            padding: 5px 10px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .config-panel {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .config-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-row:last-child {
            margin-bottom: 0;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .endpoint-tag {
            display: inline-block;
            background: #2d3748;
            color: #68d391;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: monospace;
            margin-left: 10px;
        }

        .clear-btn {
            background: transparent;
            border: 1px solid #e53e3e;
            color: #e53e3e;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .clear-btn:hover {
            background: #e53e3e;
            color: white;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .chat-input-area {
                flex-direction: column;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AIé¢è¯•æ¥å£æµ‹è¯•å¹³å°</h1>
            <p>éªŒè¯ /api/ai/interview ç³»åˆ—æ¥å£çš„å¯ç”¨æ€§ä¸ç¨³å®šæ€§</p>
        </div>

        <!-- å…¨å±€é…ç½® -->
        <div class="card" style="margin-bottom: 20px;">
            <div class="card-header">
                <div class="card-icon">âš™ï¸</div>
                <div>
                    <div class="card-title">å…¨å±€é…ç½®</div>
                    <div class="card-subtitle">é…ç½®APIåŸºç¡€åœ°å€ä¸è®¤è¯ä¿¡æ¯</div>
                </div>
            </div>
            <div class="config-row">
                <div class="form-group" style="flex: 2; margin-bottom: 0;">
                    <label>APIåŸºç¡€åœ°å€</label>
                    <input type="text" id="baseUrl" value="http://localhost:5000" placeholder="http://localhost:5000">
                </div>
                <div class="form-group" style="flex: 1; margin-bottom: 0;">
                    <label>JWT Token (å¯é€‰)</label>
                    <input type="text" id="jwtToken" placeholder="è¾“å…¥JWT Token">
                </div>
                <div class="checkbox-wrapper" style="margin-top: 20px;">
                    <input type="checkbox" id="useJwt" checked>
                    <label for="useJwt" style="margin: 0;">å¯ç”¨JWT</label>
                </div>
            </div>
        </div>

        <!-- å¯åŠ¨é¢è¯•æ¥å£æµ‹è¯•åŒº -->
        <div class="grid">
            <!-- æ–¹å¼1: æ–‡æœ¬+æ–‡æœ¬ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“</div>
                    <div>
                        <div class="card-title">æ–¹å¼1: çº¯æ–‡æœ¬æ¨¡å¼</div>
                        <div class="card-subtitle">ç®€å†æ–‡æœ¬ + å²—ä½æ–‡æœ¬ <span class="endpoint-tag">POST /text</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ç®€å†æ–‡æœ¬</label>
                    <textarea id="resumeText1" placeholder="è¯·è¾“å…¥ç®€å†å†…å®¹...">å¼ ä¸‰ï¼ŒåŒ—äº¬å¤§å­¦è®¡ç®—æœºç§‘å­¦ç¡•å£«ï¼Œ5å¹´Javaå¼€å‘ç»éªŒï¼Œç†Ÿæ‚‰Spring Bootã€å¾®æœåŠ¡æ¶æ„...</textarea>
                </div>
                <div class="form-group">
                    <label>å²—ä½æè¿°</label>
                    <textarea id="jobText1" placeholder="è¯·è¾“å…¥å²—ä½æè¿°...">é«˜çº§Javaå·¥ç¨‹å¸ˆï¼Œè¦æ±‚5å¹´ä»¥ä¸Šç»éªŒï¼Œç†Ÿæ‚‰åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè–ªèµ„30-50K...</textarea>
                </div>
                <button class="btn" onclick="startInterview('text')">
                    <span id="btnText1">å¯åŠ¨é¢è¯•</span>
                </button>
                <div id="response1" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å“åº”ç»“æœ</span>
                        <span class="response-time" id="time1"></span>
                    </div>
                    <pre id="content1"></pre>
                </div>
            </div>

            <!-- æ–¹å¼2: PDF+æ–‡æœ¬ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“„</div>
                    <div>
                        <div class="card-title">æ–¹å¼2: PDFç®€å† + æ–‡æœ¬å²—ä½</div>
                        <div class="card-subtitle">ä¸Šä¼ PDFç®€å† + å²—ä½æ–‡æœ¬ <span class="endpoint-tag">POST /pdf-text</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¸Šä¼ PDFç®€å†</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="pdfFile2" accept=".pdf" onchange="handleFileSelect(this, 'fileLabel2')">
                        <label for="pdfFile2" class="file-input-label" id="fileLabel2">
                            ğŸ“ ç‚¹å‡»é€‰æ‹©PDFæ–‡ä»¶
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>å²—ä½æè¿°</label>
                    <textarea id="jobText2" placeholder="è¯·è¾“å…¥å²—ä½æè¿°...">Pythonåç«¯å·¥ç¨‹å¸ˆï¼Œè¦æ±‚ç†Ÿæ‚‰Django/Flaskï¼Œæœ‰AIé¡¹ç›®ç»éªŒä¼˜å…ˆ...</textarea>
                </div>
                <button class="btn" onclick="startInterview('pdf-text')">
                    <span id="btnText2">å¯åŠ¨é¢è¯•</span>
                </button>
                <div id="response2" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å“åº”ç»“æœ</span>
                        <span class="response-time" id="time2"></span>
                    </div>
                    <pre id="content2"></pre>
                </div>
            </div>

            <!-- æ–¹å¼3: PDF+JobID -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ†”</div>
                    <div>
                        <div class="card-title">æ–¹å¼3: PDFç®€å† + å²—ä½ID</div>
                        <div class="card-subtitle">ä¸Šä¼ PDF + æ•°æ®åº“å²—ä½ID <span class="endpoint-tag">POST /pdf-jobid</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¸Šä¼ PDFç®€å†</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="pdfFile3" accept=".pdf" onchange="handleFileSelect(this, 'fileLabel3')">
                        <label for="pdfFile3" class="file-input-label" id="fileLabel3">
                            ğŸ“ ç‚¹å‡»é€‰æ‹©PDFæ–‡ä»¶
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>å²—ä½ID (Job ID)</label>
                    <input type="text" id="jobId3" placeholder="ä¾‹å¦‚: 1001" value="1001">
                </div>
                <button class="btn" onclick="startInterview('pdf-jobid')">
                    <span id="btnText3">å¯åŠ¨é¢è¯•</span>
                </button>
                <div id="response3" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å“åº”ç»“æœ</span>
                        <span class="response-time" id="time3"></span>
                    </div>
                    <pre id="content3"></pre>
                </div>
            </div>

            <!-- æ–¹å¼4: UserID+JobID (å…¨æ•°æ®åº“) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ—„ï¸</div>
                    <div>
                        <div class="card-title">æ–¹å¼4: å…¨æ•°æ®åº“æ¨¡å¼</div>
                        <div class="card-subtitle">ç”¨æˆ·ID + å²—ä½ID (DB) <span class="endpoint-tag">POST /userid-jobid</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ç”¨æˆ·ID (User ID)</label>
                    <input type="text" id="userId4" placeholder="ä¾‹å¦‚: user_123" value="1">
                </div>
                <div class="form-group">
                    <label>å²—ä½ID (Job ID)</label>
                    <input type="text" id="jobId4" placeholder="ä¾‹å¦‚: job_456" value="1001">
                </div>
                <button class="btn" onclick="startInterview('userid-jobid')">
                    <span id="btnText4">å¯åŠ¨é¢è¯•</span>
                </button>
                <div id="response4" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å“åº”ç»“æœ</span>
                        <span class="response-time" id="time4"></span>
                    </div>
                    <pre id="content4"></pre>
                </div>
            </div>

            <!-- æ–¹å¼5: UserID+æ–‡æœ¬ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ‘¤</div>
                    <div>
                        <div class="card-title">æ–¹å¼5: æ•°æ®åº“ç®€å† + æ–‡æœ¬å²—ä½</div>
                        <div class="card-subtitle">ç”¨æˆ·ID + å²—ä½æ–‡æœ¬ <span class="endpoint-tag">POST /userid-text</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ç”¨æˆ·ID (User ID)</label>
                    <input type="text" id="userId5" placeholder="ä¾‹å¦‚: user_123" value="1">
                </div>
                <div class="form-group">
                    <label>å²—ä½æè¿°</label>
                    <textarea id="jobText5" placeholder="è¯·è¾“å…¥å²—ä½æè¿°...">å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œè¦æ±‚ç²¾é€šVue/Reactï¼Œæœ‰3å¹´ä»¥ä¸Šç»éªŒ...</textarea>
                </div>
                <button class="btn" onclick="startInterview('userid-text')">
                    <span id="btnText5">å¯åŠ¨é¢è¯•</span>
                </button>
                <div id="response5" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å“åº”ç»“æœ</span>
                        <span class="response-time" id="time5"></span>
                    </div>
                    <pre id="content5"></pre>
                </div>
            </div>

            <!-- æ–¹å¼6: æ–‡æœ¬+JobID -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ”—</div>
                    <div>
                        <div class="card-title">æ–¹å¼6: æ–‡æœ¬ç®€å† + æ•°æ®åº“å²—ä½</div>
                        <div class="card-subtitle">ç®€å†æ–‡æœ¬ + å²—ä½ID <span class="endpoint-tag">POST /text-jobid</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ç®€å†æ–‡æœ¬</label>
                    <textarea id="resumeText6" placeholder="è¯·è¾“å…¥ç®€å†å†…å®¹...">æå››ï¼Œæ¸…åå¤§å­¦è½¯ä»¶å·¥ç¨‹æœ¬ç§‘ï¼Œ3å¹´å‰ç«¯å¼€å‘ç»éªŒï¼Œç²¾é€šVue.jsã€Webpack...</textarea>
                </div>
                <div class="form-group">
                    <label>å²—ä½ID (Job ID)</label>
                    <input type="text" id="jobId6" placeholder="ä¾‹å¦‚: 123" value="1002">
                </div>
                <button class="btn" onclick="startInterview('text-jobid')">
                    <span id="btnText6">å¯åŠ¨é¢è¯•</span>
                </button>
                <div id="response6" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å“åº”ç»“æœ</span>
                        <span class="response-time" id="time6"></span>
                    </div>
                    <pre id="content6"></pre>
                </div>
            </div>
        </div>

        <!-- é¢è¯•å¯¹è¯æµ‹è¯•åŒº -->
        <div class="chat-section" id="chatSection" style="display: none;">
            <div class="card-header" style="margin-bottom: 20px;">
                <div class="card-icon">ğŸ’¬</div>
                <div>
                    <div class="card-title">é¢è¯•å¯¹è¯æµ‹è¯• <span class="endpoint-tag">POST /{session_id}/answer</span></div>
                    <div class="card-subtitle">ä¸AIé¢è¯•å®˜è¿›è¡Œå®æ—¶å¯¹è¯</div>
                </div>
            </div>

            <div class="session-info">
                <div>
                    å½“å‰ä¼šè¯ID: <span class="session-id" id="currentSessionId">-</span>
                    <span class="status-badge pending" id="sessionStatus">è¿›è¡Œä¸­</span>
                </div>
                <button class="clear-btn" onclick="endInterview()">ç»“æŸé¢è¯•</button>
            </div>

            <div class="audio-controls">
                <button class="audio-btn active" onclick="toggleAudio(this)" id="audioToggle">
                    ğŸ”Š å¯ç”¨è¯­éŸ³æ’­æ”¾
                </button>
                <button class="audio-btn" onclick="downloadReport()">
                    ğŸ“Š ä¸‹è½½é¢è¯•æŠ¥å‘Š
                </button>
                <button class="audio-btn" onclick="viewHistory()">
                    ğŸ“œ æŸ¥çœ‹èŠå¤©è®°å½•
                </button>
            </div>

            <div class="chat-container" id="chatContainer">
                <div class="message interviewer">
                    <div class="message-bubble">æ¬¢è¿ä½¿ç”¨AIé¢è¯•ç³»ç»Ÿï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹"å¯åŠ¨é¢è¯•"å¼€å§‹...</div>
                    <div class="message-meta">ç³»ç»Ÿ</div>
                </div>
            </div>

            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥æ‚¨çš„å›ç­”..." onkeypress="handleEnter(event)">
                <button class="btn" style="width: 120px;" onclick="sendAnswer()">å‘é€</button>
            </div>
        </div>

        <!-- å…¶ä»–åŠŸèƒ½æµ‹è¯• -->
        <div class="grid">
            <!-- è¯­éŸ³å¬å†™æµ‹è¯• -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ¤</div>
                    <div>
                        <div class="card-title">è¯­éŸ³å¬å†™æµ‹è¯•</div>
                        <div class="card-subtitle">POST /{session_id}/transcribe</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¼šè¯ID</label>
                    <input type="text" id="transcribeSessionId" placeholder="è¾“å…¥ä¼šè¯ID">
                </div>
                <div class="form-group">
                    <label>ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ (MP3/WAV)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="audioFile" accept="audio/*" onchange="handleFileSelect(this, 'audioFileLabel')">
                        <label for="audioFile" class="file-input-label" id="audioFileLabel">
                            ğŸµ é€‰æ‹©éŸ³é¢‘æ–‡ä»¶
                        </label>
                    </div>
                </div>
                <button class="btn" onclick="testTranscribe()">æµ‹è¯•è¯­éŸ³è¯†åˆ«</button>
                <div id="responseTranscribe" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">è¯†åˆ«ç»“æœ</span>
                        <span class="response-time" id="timeTranscribe"></span>
                    </div>
                    <pre id="contentTranscribe"></pre>
                </div>
            </div>

            <!-- è·å–å†å²è®°å½• -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“š</div>
                    <div>
                        <div class="card-title">è·å–é¢è¯•å†å²</div>
                        <div class="card-subtitle">GET /{session_id}/history</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¼šè¯ID</label>
                    <input type="text" id="historySessionId" placeholder="è¾“å…¥ä¼šè¯ID">
                </div>
                <button class="btn" onclick="getHistory()">æŸ¥è¯¢å†å²</button>
                <div id="responseHistory" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">å†å²è®°å½•</span>
                        <span class="response-time" id="timeHistory"></span>
                    </div>
                    <pre id="contentHistory"></pre>
                </div>
            </div>

            <!-- ä¸‹è½½æŠ¥å‘Š -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“ˆ</div>
                    <div>
                        <div class="card-title">ä¸‹è½½é¢è¯•æŠ¥å‘Š</div>
                        <div class="card-subtitle">GET /{session_id}/report</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¼šè¯ID</label>
                    <input type="text" id="reportSessionId" placeholder="è¾“å…¥ä¼šè¯ID">
                </div>
                <button class="btn" onclick="downloadReportManual()">ä¸‹è½½æŠ¥å‘Š</button>
                <div id="responseReport" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">æŠ¥å‘Šå†…å®¹</span>
                        <span class="response-time" id="timeReport"></span>
                    </div>
                    <pre id="contentReport"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentSession = null;
        let audioEnabled = true;
        let messageHistory = [];

        // å·¥å…·å‡½æ•°ï¼šè·å–åŸºç¡€URL
        function getBaseUrl() {
            return document.getElementById('baseUrl').value.trim() || 'http://localhost:5000';
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–è¯·æ±‚å¤´
        function getHeaders() {
            const headers = {
                'Content-Type': 'application/json'
            };

            if (document.getElementById('useJwt').checked) {
                const token = document.getElementById('jwtToken').value.trim();
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
            }

            return headers;
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        function handleFileSelect(input, labelId) {
            const label = document.getElementById(labelId);
            if (input.files && input.files[0]) {
                label.textContent = `âœ… ${input.files[0].name}`;
                label.classList.add('has-file');
            } else {
                label.textContent = input.accept.includes('pdf') ? 'ğŸ“ ç‚¹å‡»é€‰æ‹©PDFæ–‡ä»¶' : 'ğŸµ é€‰æ‹©éŸ³é¢‘æ–‡ä»¶';
                label.classList.remove('has-file');
            }
        }

        // æ˜¾ç¤ºå“åº”
        function showResponse(index, data, isError = false) {
            const panel = document.getElementById(`response${index}`);
            const content = document.getElementById(`content${index}`);
            const time = document.getElementById(`time${index}`);

            panel.classList.remove('hidden', 'error', 'loading');
            if (isError) panel.classList.add('error');

            content.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
            time.textContent = new Date().toLocaleTimeString();
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(index) {
            const panel = document.getElementById(`response${index}`);
            const content = document.getElementById(`content${index}`);
            panel.classList.remove('hidden');
            panel.classList.add('loading');
            content.textContent = 'è¯·æ±‚ä¸­...';
        }

        // å¯åŠ¨é¢è¯•ä¸»å‡½æ•°
        async function startInterview(type) {
            const baseUrl = getBaseUrl();
            let endpoint = '';
            let body = {};
            let fileInput = null;

            // æ ¹æ®ç±»å‹å‡†å¤‡æ•°æ®
            switch(type) {
                case 'text':
                    endpoint = '/api/ai/interview/start/text';
                    body = {
                        resume_text: document.getElementById('resumeText1').value,
                        job_text: document.getElementById('jobText1').value
                    };
                    if (!body.resume_text || !body.job_text) {
                        alert('è¯·å¡«å†™ç®€å†æ–‡æœ¬å’Œå²—ä½æè¿°');
                        return;
                    }
                    break;

                case 'pdf-text':
                    endpoint = '/api/ai/interview/start/pdf-text';
                    fileInput = document.getElementById('pdfFile2');
                    const jobText2 = document.getElementById('jobText2').value;
                    if (!fileInput.files[0] || !jobText2) {
                        alert('è¯·ä¸Šä¼ PDFæ–‡ä»¶å¹¶å¡«å†™å²—ä½æè¿°');
                        return;
                    }
                    body = {
                        resume_file: await fileToBase64(fileInput.files[0]),
                        job_text: jobText2
                    };
                    break;

                case 'pdf-jobid':
                    endpoint = '/api/ai/interview/start/pdf-jobid';
                    fileInput = document.getElementById('pdfFile3');
                    const jobId3 = document.getElementById('jobId3').value;
                    if (!fileInput.files[0] || !jobId3) {
                        alert('è¯·ä¸Šä¼ PDFæ–‡ä»¶å¹¶å¡«å†™å²—ä½ID');
                        return;
                    }
                    body = {
                        resume_file: await fileToBase64(fileInput.files[0]),
                        job_id: jobId3
                    };
                    break;

                case 'userid-jobid':
                    endpoint = '/api/ai/interview/start/userid-jobid';
                    body = {
                        user_id: document.getElementById('userId4').value,
                        job_id: document.getElementById('jobId4').value
                    };
                    if (!body.user_id || !body.job_id) {
                        alert('è¯·å¡«å†™ç”¨æˆ·IDå’Œå²—ä½ID');
                        return;
                    }
                    break;

                case 'userid-text':
                    endpoint = '/api/ai/interview/start/userid-text';
                    body = {
                        user_id: document.getElementById('userId5').value,
                        job_text: document.getElementById('jobText5').value
                    };
                    if (!body.user_id || !body.job_text) {
                        alert('è¯·å¡«å†™ç”¨æˆ·IDå’Œå²—ä½æè¿°');
                        return;
                    }
                    break;

                case 'text-jobid':
                    endpoint = '/api/ai/interview/start/text-jobid';
                    body = {
                        resume_text: document.getElementById('resumeText6').value,
                        job_id: document.getElementById('jobId6').value
                    };
                    if (!body.resume_text || !body.job_id) {
                        alert('è¯·å¡«å†™ç®€å†æ–‡æœ¬å’Œå²—ä½ID');
                        return;
                    }
                    break;
            }

            // è·å–å¯¹åº”çš„åºå·ç”¨äºæ˜¾ç¤º
            const indexMap = {
                'text': '1', 'pdf-text': '2', 'pdf-jobid': '3',
                'userid-jobid': '4', 'userid-text': '5', 'text-jobid': '6'
            };
            const index = indexMap[type];

            // ç¦ç”¨æŒ‰é’®
            const btn = document.querySelector(`#btnText${index}`).parentElement;
            btn.disabled = true;
            document.querySelector(`#btnText${index}`).innerHTML = '<span class="loading-spinner"></span>å¯åŠ¨ä¸­...';

            showLoading(index);

            try {
                const response = await fetch(`${baseUrl}${endpoint}`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse(index, data, !response.ok);

                // å¦‚æœæˆåŠŸï¼Œåˆå§‹åŒ–ä¼šè¯
                if (response.ok && data.session_id) {
                    initChatSession(data);
                }

            } catch (error) {
                showResponse(index, `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            } finally {
                btn.disabled = false;
                document.querySelector(`#btnText${index}`).textContent = 'å¯åŠ¨é¢è¯•';
            }
        }

        // æ–‡ä»¶è½¬Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    // ç§»é™¤Data URLå‰ç¼€ï¼Œåªä¿ç•™base64æ•°æ®
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // åˆå§‹åŒ–èŠå¤©ä¼šè¯
        function initChatSession(data) {
            currentSession = data;
            messageHistory = [];

            // æ˜¾ç¤ºèŠå¤©åŒºåŸŸ
            document.getElementById('chatSection').style.display = 'block';
            document.getElementById('currentSessionId').textContent = data.session_id;
            document.getElementById('sessionStatus').textContent = 'è¿›è¡Œä¸­';
            document.getElementById('sessionStatus').className = 'status-badge pending';

            // æ¸…ç©ºå¹¶åˆå§‹åŒ–èŠå¤©è®°å½•
            const container = document.getElementById('chatContainer');
            container.innerHTML = '';

            // æ·»åŠ é¢è¯•å®˜çš„ç¬¬ä¸€ä¸ªé—®é¢˜
            if (data.question) {
                addMessage('interviewer', data.question, data.audio_url);
            }

            // æ»šåŠ¨åˆ°èŠå¤©åŒºåŸŸ
            document.getElementById('chatSection').scrollIntoView({ behavior: 'smooth' });
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©çª—å£
        function addMessage(role, content, audioUrl = null) {
            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = `message ${role}`;

            let html = `<div class="message-bubble">${escapeHtml(content)}</div>`;
            html += `<div class="message-meta">${role === 'interviewer' ? 'AIé¢è¯•å®˜' : 'å€™é€‰äºº'} Â· ${new Date().toLocaleTimeString()}</div>`;

            div.innerHTML = html;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;

            // æ’­æ”¾è¯­éŸ³
            if (audioEnabled && audioUrl && role === 'interviewer') {
                playAudio(audioUrl);
            }

            // ä¿å­˜å†å²
            messageHistory.push({
                role: role,
                content: content,
                time: new Date().toISOString()
            });
        }

        // è½¬ä¹‰HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // æ’­æ”¾éŸ³é¢‘
        function playAudio(url) {
            const baseUrl = getBaseUrl();
            const fullUrl = url.startsWith('http') ? url : `${baseUrl}${url}`;
            const audio = new Audio(fullUrl);
            audio.play().catch(e => console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));
        }

        // å‘é€å›ç­”
        async function sendAnswer() {
            if (!currentSession) {
                alert('è¯·å…ˆå¯åŠ¨ä¸€ä¸ªé¢è¯•ä¼šè¯');
                return;
            }

            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage('candidate', text);
            input.value = '';

            // ç¦ç”¨è¾“å…¥
            input.disabled = true;
            const btn = document.querySelector('#chatInput').nextElementSibling;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span>';

            try {
                const baseUrl = getBaseUrl();
                const response = await fetch(`${baseUrl}/api/ai/interview/${currentSession.session_id}/answer`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({
                        user_text: text,
                        end_interview: false
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'è¯·æ±‚å¤±è´¥');
                }

                if (data.is_ended) {
                    document.getElementById('sessionStatus').textContent = 'å·²ç»“æŸ';
                    document.getElementById('sessionStatus').className = 'status-badge success';
                    addMessage('system', 'é¢è¯•å·²ç»“æŸï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š');
                } else {
                    addMessage('interviewer', data.question, data.audio_url);
                }

            } catch (error) {
                addMessage('system', `é”™è¯¯: ${error.message}`);
            } finally {
                input.disabled = false;
                btn.disabled = false;
                btn.textContent = 'å‘é€';
                input.focus();
            }
        }

        // å¤„ç†å›è½¦é”®
        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendAnswer();
            }
        }

        // ç»“æŸé¢è¯•
        async function endInterview() {
            if (!currentSession) return;

            const baseUrl = getBaseUrl();
            try {
                await fetch(`${baseUrl}/api/ai/interview/${currentSession.session_id}/answer`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({
                        user_text: 'ç»“æŸé¢è¯•',
                        end_interview: true
                    })
                });

                document.getElementById('sessionStatus').textContent = 'å·²ç»“æŸ';
                document.getElementById('sessionStatus').className = 'status-badge success';
                addMessage('system', 'é¢è¯•å·²æ‰‹åŠ¨ç»“æŸ');
            } catch (error) {
                alert('ç»“æŸé¢è¯•å¤±è´¥: ' + error.message);
            }
        }

        // åˆ‡æ¢éŸ³é¢‘
        function toggleAudio(btn) {
            audioEnabled = !audioEnabled;
            btn.classList.toggle('active');
            btn.textContent = audioEnabled ? 'ğŸ”Š å¯ç”¨è¯­éŸ³æ’­æ”¾' : 'ğŸ”‡ ç¦ç”¨è¯­éŸ³æ’­æ”¾';
        }

        // ä¸‹è½½æŠ¥å‘Š
        async function downloadReport() {
            if (!currentSession) {
                alert('è¯·å…ˆå¯åŠ¨é¢è¯•');
                return;
            }
            window.open(`${getBaseUrl()}/api/ai/interview/${currentSession.session_id}/report`, '_blank');
        }

        // æŸ¥çœ‹å†å²
        async function viewHistory() {
            if (!currentSession) {
                alert('è¯·å…ˆå¯åŠ¨é¢è¯•');
                return;
            }

            const baseUrl = getBaseUrl();
            try {
                const response = await fetch(`${baseUrl}/api/ai/interview/${currentSession.session_id}/history`, {
                    headers: getHeaders()
                });
                const data = await response.json();
                console.log('å†å²è®°å½•:', data);
                alert(JSON.stringify(data, null, 2));
            } catch (error) {
                alert('è·å–å†å²å¤±è´¥: ' + error.message);
            }
        }

        // æµ‹è¯•è¯­éŸ³è¯†åˆ«
        async function testTranscribe() {
            const sessionId = document.getElementById('transcribeSessionId').value;
            const fileInput = document.getElementById('audioFile');

            if (!sessionId || !fileInput.files[0]) {
                alert('è¯·è¾“å…¥ä¼šè¯IDå¹¶é€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                return;
            }

            showLoading('Transcribe');
            const baseUrl = getBaseUrl();

            try {
                const formData = new FormData();
                formData.append('audio_file', fileInput.files[0]);

                const response = await fetch(`${baseUrl}/api/ai/interview/${sessionId}/transcribe`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showResponse('Transcribe', data, !response.ok);
            } catch (error) {
                showResponse('Transcribe', `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        // è·å–å†å²è®°å½•
        async function getHistory() {
            const sessionId = document.getElementById('historySessionId').value;
            if (!sessionId) {
                alert('è¯·è¾“å…¥ä¼šè¯ID');
                return;
            }

            showLoading('History');
            const baseUrl = getBaseUrl();

            try {
                const response = await fetch(`${baseUrl}/api/ai/interview/${sessionId}/history`, {
                    headers: getHeaders()
                });

                const data = await response.json();
                showResponse('History', data, !response.ok);
            } catch (error) {
                showResponse('History', `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        // æ‰‹åŠ¨ä¸‹è½½æŠ¥å‘Š
        async function downloadReportManual() {
            const sessionId = document.getElementById('reportSessionId').value;
            if (!sessionId) {
                alert('è¯·è¾“å…¥ä¼šè¯ID');
                return;
            }

            showLoading('Report');
            const baseUrl = getBaseUrl();

            try {
                const response = await fetch(`${baseUrl}/api/ai/interview/${sessionId}/report`, {
                    headers: getHeaders()
                });

                if (response.ok) {
                    const data = await response.json();
                    showResponse('Report', data);
                } else {
                    const text = await response.text();
                    showResponse('Report', text, true);
                }
            } catch (error) {
                showResponse('Report', `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.onload = () => {
            console.log('AIé¢è¯•æ¥å£æµ‹è¯•å¹³å°å·²åŠ è½½');
            console.log('æ”¯æŒçš„æ¥å£:');
            console.log('1. POST /api/ai/interview/start/text');
            console.log('2. POST /api/ai/interview/start/pdf-text');
            console.log('3. POST /api/ai/interview/start/pdf-jobid');
            console.log('4. POST /api/ai/interview/start/userid-jobid');
            console.log('5. POST /api/ai/interview/start/userid-text');
            console.log('6. POST /api/ai/interview/start/text-jobid');
            console.log('7. POST /api/ai/interview/{session_id}/transcribe');
            console.log('8. POST /api/ai/interview/{session_id}/answer');
            console.log('9. GET  /api/ai/interview/{session_id}/history');
            console.log('10. GET /api/ai/interview/{session_id}/report');
        };
    </script>
</body>
</html>